{% extends "base.html" %}

{% block title -%}
    {{office.title | safe}}
{%- endblock %}

{% block desc -%}
    {{office.desc | safe}}
{%- endblock %}


{% block content %}

    {# Variables #}
    
    {% set path = '/offices/' ~ office.slug ~ '/' %}
    {% set office_name = office.title %}
    {% set office_slug = office.slug %}

    {# Macros #}

    {% import "post-macros.html" as post_macros with context %}
    
    
    <main class="content content__1-3" id="main" role="main">

        <!-- .content_bar must come after .content_hero but before .content_wrapper -->
        <div class="content_bar"></div>

        <div class="wrapper content_wrapper office">

            <aside class="content_sidebar content__flush-all-on-small">
                {% include "_offices-nav.html" %}
            </aside>

            <div class="content_main 
                        content__flush-bottom 
                        content__flush-top-on-small">
                <h1>{{office.title | safe}}</h1>
                <div class="{% if office.contact %} 
                                content-l
                                content-l__large-gutters
                            {% endif %}">
                    <section class="office_intro 
                                    {% if office.contact %}
                                        content-l_col 
                                        content-l_col-1-2
                                    {% endif %}">
                        <p class="h3">{{office.intro_text | safe}}</p>
                    </section>
                    
                    {% if office.contact %}
                    <section class="office_contact 
                                    content-l_col 
                                    content-l_col-1-2
                                    content-l_col__before-divider">
                        <p class="h3 u-show-on-mobile">Stay informed</p>
                        <p class="short-desc">Stay up to date with our email newsletter</p>
                        <!-- TODO: need correct query data for email -->
                        <!-- TODO: the include prob won't work with inline form -->
                        {% include "email-subscribe-form.html" %}
                    </section>
                    {% endif %}
                    
                </div>
                
                
                {% if office.top_story_head %}
                <section class="office_featured
                                block 
                                block__padded-top 
                                block__sub
                                block__border-top">
                    <h1 class="h3">{{office.top_story_head | safe}}</h1>
                    <div class="content-l
                                content-l__large-gutters">
                        <div class="content-l_col
                                    content-l_col-1-2">
                            <p class="short-desc">{{office.top_story_desc | safe if office.top_story_desc}}</p>
                        </div>
                        <div class="content-l_col 
                                    content-l_col-1-2
                                    content-l_col__before-divider">
                            <ul class="list__links">
                                {% for link in office.top_story_links %}
                                	<li class="list_item">
                                        <a class="jump-link 
                                                  jump-link__right 
                                                  list_link"
                                           href="{{link[0]}}">
                                            {{link[1]}}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </section>
                {% endif %}
                
                
                {% if office.resources %}
                    <section class="office_initiatives
                                    block__sub
                                    block 
                                    block__padded-top 
                                    block__border-top">
                        <h1 class="h2">
                            Our Work
                        </h1>
                        <div class="content-l 
                                    content-l__large-gutters
                                    expandables-group">
                            
                            {% for resource in office.resources %}
                                <!-- TODO: link header styles -->
                                <div class="office_initiative
                                            expandable 
                                            expandable__expanded 
                                            expandable__mobile-only
                                            content-l_col
                                            {% if office.resources|length > 1 %}
                                                content-l_col-1-2
                                            {% else %}
                                                content-l_col-1
                                            {% endif %}">
                                      <button class="expandable_header
                                                     expandable_target
                                                     u-show-on-mobile">
                                          <span class="expandable_header-left 
                                                       expandable_label">
                                              {{resource.head | safe}}
                                          </span>
                                          <span class="expandable_header-right 
                                                       expandable_link">
                                              <span class="expandable_cue-open">
                                                  <span class="cf-icon 
                                                               cf-icon-plus-round">
                                                  </span>
                                              </span>
                                              <span class="expandable_cue-close">
                                                  <span class="cf-icon 
                                                               cf-icon-minus-round">
                                                  </span>
                                              </span>
                                          </span>
                                      </button>
                                      <div class="expandable_content">
                                          <h2 class="h4
                                                     u-hide-on-mobile">
                                              {{resource.head | safe}}
                                          </h2>
                                          <p class="short-desc">
                                              {{resource.desc | safe}}
                                          </p>
                                          <a class="jump-link 
                                                    jump-link__right"
                                             href="{{resource.link[0] if resource.link}}">
                                              {{resource.link[1] if resource.link}}
                                          </a>
                                      </div><!-- END .expandable -->
                                </div>
                            {% endfor %}
                        </div>
                    </section>
                {% endif %}
                
                <div class="block
                            block__flush-sides
                            block__bg
                            u-mb0
                            u-mt0">    
                    <section class="office_activities">
                        <h1 class="header-slug">
                            <span class="header-slug_inner">
                                Latest Office Activities
                            </span>
                        </h1>
                        {% from "post-macros.html" import activity_snippets as activity_snippets with context %}
                        {{ activity_snippets(activity_type) }}
                        <div class="content-l">    
                            <!-- link to activities page? -->
                            <div class="content-l_col-1">
                                <a class="jump-link 
                                          jump-link__right">
                                    View all of our activity
                                </a>
                            </div>
                        </div>
                    </section>
                    <section class="office_content 
                                    block
                                    u-mb0">
                        <h1 class="header-slug">
                            <span class="header-slug_inner">
                                Office Contact Information
                            </span>
                        </h1>
                        <p class="short-desc">
                            Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor.
                        </p>
                        <h2 class="h5">General Inquiries</h2>
                        <a class="list_link" href="mailto:">
                            email address
                        </a>
                            
                    </section>
                </div>
                
                
            </div><!-- END .content_main -->

        </div><!-- END .content_wrapper -->
    </main><!-- END .content -->

{% endblock content %}

{% block javascript %}
    {{ super() }}
    <script>
                
        $('document').ready(function () { 
            
            if (!$('html').hasClass('lt-ie9')) { 

                $('.expandable__mobile-only').each(function (i) {
                    new MobileOnlyExpandable($(this), 599);
                });
                
            }
            
        });
        
    </script>
{% endblock javascript %}