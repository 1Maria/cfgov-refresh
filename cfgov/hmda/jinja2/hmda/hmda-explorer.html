{% extends 'layout-side-nav.html' %}

{% import 'form_block.html' as form_block with context %}
{% import 'hmda-explorer-controls.html' as controls with context %}
{% import 'hmda-explorer-results.html' as results with context %}
{% import 'hmda-explorer-institutions.html' as institutions with context %}
{% import 'templates/render_block.html' as render_block with context %}
{% import 'templates/streamfield-sidefoot.html' as streamfield_sidefoot with context %}

{% block css -%}
    {{ super() }}
    <link rel="stylesheet" href="{{ static('apps/hmda/css/main.css') }}">
{%- endblock css %}

{% block content_main_modifiers -%}
    {{ super() }} content__flush-bottom
{%- endblock %}

{% block content_main %}
    {% for block in page.header -%}
        {% if 'featured_content' in block.block_type %}
            <div class="block
                        block__border
                        {{ 'u-mt0' if loop.first }}">
                        {# u-mt0 is used instead of block__flush-top to keep top border #}
                {% include_block block %}
            </div>
        {% else %}
            {{ render_block.render(block, loop.index) }}
        {% endif %}
    {%- endfor %}

    <div class="hmda-historic-data" style="margin-top: -20px">

        {{ controls.render(form) }}

        {{ results.render(
            title,
            files)
        }}

        <p>For an explanation of each field <a href="#">review the variable list</a> or <a href="#">find code explanations</a>.</p>

        {{ institutions.render() }}

        <p>See the documentation for the <a href="#">transmittal sheet</a> and <a href="#">panel data</a>.</p>

        {% for block in page.content -%}
            {% if block.block_type in ['feedback', 'conference_registration_form'] %}
                {{- form_block.render(block, 'content', loop.index0) -}}
            {% else %}
                {{ render_block.render(block, loop.index) }}
            {% endif %}
        {%- endfor %}

    </div>

    {% if page.sidefoot %}
        <aside class="o-prefooter">
            {{ streamfield_sidefoot.render(page.sidefoot, half_width=true) }}
        </aside>
    {% endif %}
{% endblock %}

{% block javascript scoped %}
    {{ super() }}
    <script async>
      if ( document.body.parentElement.className.indexOf( 'no-js' ) === -1 ) {
        !function(){
          {# Include site-wide JavaScript. #}
          var s = [
            '{{ static('apps/hmda/js/index.js') }}'
          ];
          jsl(s);
        }()
      }
    </script>
{% endblock javascript %}
