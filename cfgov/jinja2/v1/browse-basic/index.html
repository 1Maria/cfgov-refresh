{% extends 'layout-side-nav.html' %}

{# Import organisms and molecules used in the template. #}

{% import 'molecules/related-posts.html' as related_posts with context %}
{% if not breadcrumb_items %}
    {% set parent = page.parent() %}
    {% set breadcrumb_items = [(parent.url, parent.url, parent.title)] %}
{% endif %}

{% block title -%}
    {{ page.seo_title }}
{%- endblock %}

{% block content_main_modifiers -%}
    {{ super() }} content__flush-bottom
{%- endblock %}

{% block content_main %}
    {% for block in page.header -%}
        {% if loop.index == 1 %}
            <div class="block
                        block__flush-top">
                {{ render_stream_child(block) }}
            </div>
        {% else %}
            <div class="block">
                {{ render_stream_child(block) }}
            </div>
        {% endif %}
    {%- endfor %}

    {% for block in page.content -%}
        <div class="block">
            {{ render_stream_child(block) }}
        </div>
    {%- endfor %}

    <div class="block
                block__flush-bottom
                block__flush-sides
                block__bg
                block__border-top
                block__border-right">
        {% for block in page.sidefoot %}
            {% if 'related_posts' or 'call_to_action' or 'email_signup' in block.block_type %}
                {% if loop.index == 1 %}
                    <div class="block
                                block__flush-top">
                        {{ render_stream_child(block) }}
                    </div>
                {% else %}
                    <div class="block">
                        {{ render_stream_child(block) }}
                    </div>
                {% endif %}
            {# TODO: When we delete atoms, remove the following else #}
            {% else %}
                {% if 'heading' in block.block_type %}
                    <h3 class="o-sidebar-breakout_heading">
                        {{ render_stream_child(block) }}
                    </h3>
                {% elif 'slug' in block.block_type %}
                    <h2 class="header-slug">
                        <span class="header-slug_inner">
                            {{ render_stream_child(block) }}
                        </span>
                    </h2>
                {% else %}
                    <p>{{ render_stream_child(block) }}</p>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}

{% block content_sidebar scoped -%}
    {% for block in page.side_navigation -%}
        <div class="block">
            {{ render_stream_child(block) }}
        </div>
    {%- endfor %}
{%- endblock %}
