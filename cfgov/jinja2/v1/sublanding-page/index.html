{% extends 'layout-2-1-bleedbar.html' %}

{% import 'molecules/related-posts.html' as related_posts with context %}
>>>>>>> removed prototype data from page templates to resolve bug

{% block title -%}
    {{ page.seo_title }}
{%- endblock %}

{% block hero -%}
    {% for block in page.header -%}
        {% if 'hero' in block.block_type -%}
            {{ render_stream_child(block) }}
        {%- endif %}
    {%- endfor %}
{% endblock %}

{% block pre_content %}
    {% if page.sidebar_breakout %}
        {% include 'organisms/sidebar-breakout.html' %}
    {% endif %}
{% endblock %}

{% block content_main %}
    {% for block in page.content -%}
        {% if loop.index == 1 %}
            <div class="block
                        block__flush-top">
                {{ render_stream_child(block) }}
            </div>
        {% else %}
            <div class="block">
                {{ render_stream_child(block) }}
            </div>
        {% endif %}

        {% for block in page.content -%}
            {% if loop.index == 1 %}
                <div class="block
                            block__flush-top">
            {% else %}
                <div class="block">
            {% endif %}
            {% if 'post_preview_snapshot' in block.block_type %}
                {% set posts = page.get_browsefilterable_posts(request) %}
                {% set limit = block.value.limit | int %}
                {% set num_posts = limit if limit <= posts | length else posts | length %}
                {% for i in range(num_posts) %}
                    {{ post_preview.render(posts[i], '', 0, pageurl(posts[i].parent())) }}
                {% endfor %}
            {% else %}
                {{ render_stream_child(block) }}
            {% endif %}
                </div>
        {%- endfor %}
    {%- endfor %}
{% endblock %}

{% block content_sidebar_modifiers -%}
    o-sidebar-content
{%- endblock %}

{% block content_sidebar scoped -%}
    {% for block in page.sidefoot %}
        {% if 'related_posts' in block.block_type %}
            {% import 'molecules/related-posts.html' as related_posts with context %}
            {{ related_posts.render(block) }}
        {% elif 'email_signup' in block.block_type %}
            {{ render_stream_child(block) }}
        {% else %}
            {% if 'heading' in block.block_type %}
                <h3 class="o-sidebar-breakout_heading">
                    {{ render_stream_child(block) }}
                </h3>
            {% elif 'slug' in block.block_type %}
                <h2 class="header-slug">
                        <span class="header-slug_inner">
                            {{ render_stream_child(block) }}
                        </span>
                </h2>
            {% elif 'paragraph' in block.block_type %}
                {{ render_stream_child(block) }}
            {% else %}
                {{ render_stream_child(block) }}
            {% endif %}
        {% endif %}
    {%- endfor %}
{%- endblock %}
