{% extends 'layout-2-1-bleedbar.html' %}

{% import 'molecules/featured-content.html' as featured_content %}
{% import 'organisms/post-preview.html' as post_preview with context %}
{% import 'templates/streamfield-sidefoot.html' as streamfield_sidefoot with context %}

{% block title -%}
    {{ page.seo_title }}
{%- endblock %}

{% block hero -%}
    {% for block in page.header -%}
        {% include 'templates/render_block.html' with context %}
    {%- endfor %}
{% endblock %}

{% block pre_content %}
    {% if page.sidebar_breakout %}
        {% import 'organisms/sidebar-breakout.html' as sidebar_breakout with context %}
        {% call(block) sidebar_breakout.render() %}
            {{ render_stream_child(block) }}
        {% endcall %}
    {% endif %}
{% endblock %}

{% block content_main %}
    {% for block in page.content -%}
        {% if 'featured_content' in block.block_type %}
            <div class="block
                        block__flush-sides">
                {{ featured_content.render(block.value) }}
            </div>
        {% elif 'post_preview_snapshot' in block.block_type %}
            <div class="block 
                        {{ block.block.meta.classname if block.block.meta.classname else '' }}">
                {% set posts = page.get_browsefilterable_posts(request) %}
                {% set limit = block.value.limit | int %}
                {% set num_posts = limit if limit <= posts | length else posts | length %}
                {% for i in range(num_posts) %}
                    {{ post_preview.render(posts[i], '', 0, get_protected_url(posts[i].parent())) }}
                {% endfor %}
             </div>
        {% elif 'filter_controls' in block.block_type %}
            <div class="block block__flush-top">
                {% set f = forms.pop(0) %}
                {% from 'organisms/filterable-list-controls.html' import render as flc with context %}
                {{ flc(block.value, f, loop.index0) }}
            </div>
        {% elif 'text_introduction' not in block.block_type %}
            {% include 'templates/render_block.html' with context %}
        {% elif not page.sidebar_breakout %}
            {% include 'templates/render_block.html' with context %}
        {% endif %}
    {%- endfor %}
{% endblock %}

{% block content_sidebar_modifiers -%}
    o-sidebar-content
{%- endblock %}

{% block content_sidebar scoped -%}
    {{ streamfield_sidefoot.render(page.sidefoot) }}
{%- endblock %}
