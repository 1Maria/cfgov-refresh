{# ==========================================================================

   Info Unit

   ==========================================================================

   Description:

   Create an info-unit molecule when given:

   value:                        Object defined from a StreamField block.

   value.modifier:               A modifier CSS class used to alternate
                                 the info unit from stacked to inline layouts.

   value.image:                  (Optional) An object containing:

   value.image.is_decorative:    Whether the image is a bg image or not.
                                 Default is false.

   value.image.is_square:        Whether the image is square or not.
                                 Default is false.

   value.image.url:              String for the image URL.

   value.image.alt:              String for image alt text.

   value.heading:                The heading for the info unit.

   value.heading_level:          The heading level (H2, H3, or H4).

   value.heading_icon:           An optional cf-icons icon code that
                                 triggers the insertion of an icon before
                                 the heading.

   value.body:                   A string containing the content to display
                                 below the heading (typically a paragraph).

   value.links:                  A tuple of items to create a list of links,
                                 containing:

   value.links[i].url:           A string for the URL of the link.

   value.links[i].text:          A string for the text of the link.

   value.is_button:              Boolean for whether the link should be
                                 rendered as a button. Default is false.

   value.link_image_and_heading: Boolean for whether the image and heading
                                 should be linked to the value.links[0].url.

   ========================================================================== #}

{% macro info_unit(value, format, link_image_and_heading) %}

{# Confirm that not only is link_image_and_heading set, but that this
   particular info unit has a link in its list. #}
{% set link_image_and_heading = link_image_and_heading
                                and value.links
                                and value.links[0]
                                and value.links[0].url %}

<div class="m-info-unit
            {{- ' m-info-unit__inline' if format == '25-75' else '' }}">

{% if value.image.upload %}
    {% set img = image(value.image.upload, 'original') %}
    {% if link_image_and_heading %}
        <a href="{{ value.links[0].url }}">
    {% endif %}
    {% if value.image.alt %}
            <img src="{{ img.url }}"
                 alt="{{ value.image.alt if value.image.alt else '' }}"
                 class="m-info-unit_image
                        {{- ' m-info-unit_image__square' if value.image.is_widescreen == False else '' }}">
    {% else %}
            <div class="m-info-unit_image
                        {{- ' m-info-unit_image__square' if value.image.is_widescreen == False else '' }}"
                 style="background-image: url( {{ img.url }} );">
            </div>
    {% endif %}
    {% if link_image_and_heading %}
        </a>
    {% endif %}
{% endif %}

    <div class="m-info-unit_content">
{% if value.heading %}
    {% if link_image_and_heading %}
        <a class="m-info-unit_heading-link" href="{{ value.links[0].url }}">
    {% endif %}
            <{{ value.heading_level -}}
                {%- if value.heading_icon -%}
                    {{- ' class="cf-icon cf-icon-' ~ value.heading_icon ~ '"' -}}
                {%- endif -%}
            >
                {{ value.heading | safe }}
            </{{ value.heading_level }}>
    {% if link_image_and_heading %}
        </a>
    {% endif %}
{% endif %}

        {{ parse_links( value.body ) | safe }}

{% if value.links %}
        <ul class="m-list m-list__links u-mt15">
    {% for link in value.links %}
            <li class="m-list_item">
            {% if link.text is defined and link.text.find('@') > -1 %}
                {% if not value.emails is defined %}
                    {% do value.update({'emails':[{'url':link.text}]}) %}
                {% endif %}
                {% include 'contact-email.html' with context %}
            {% else %}
                {% set link_class = 'a-btn m-info-unit_btn' if
                    value.is_button else 'm-list_link' %}
                {% set link_text = link.text if link.text
                    else 'Learn More' %}
                {% set link = '<a class="' ~ link_class ~ '" href="' ~
                    link.url ~ '">' ~ link_text ~ '</a>' %}
                {{ parse_links( link ) | safe }}
            {% endif %}
            </li>
    {% endfor %}
        </ul>
{% endif %}

    </div>

</div>

{% endmacro %}
