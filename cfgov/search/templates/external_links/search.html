{% extends "wagtailadmin/base.html" %}
{% load i18n %}
{% block titletag %}{% trans "External Links Management" %}{% endblock %}

{# Note: uses local version of "wagtailadmin/pages/listing/_list_explore.html" for
   page results, revised to open links in new tab and only show edit/view actions. #}

{% block content %}

    {% block header %}
        <style>
            .external-links-search-form button {
                font-size: .95em;
                padding: 0 1.4em;
                height: 3em;
            }



            .external-links-search-form  {
                max-width: 600px;
                display: flex;
            }

            .external-links-search-form .field {
                flex: 2;
                margin-right: 10px;
            }

            .external-links-search-form .icon-search::before {
                top: .4em;
                font-size: 1.6em;
            }

            .external-links-search-form input {
                padding: .5em 1.2em;
                
            }
        </style>
        <header class="nice-padding hasform">
            <div class="row header-title">
                <div class="left">
                    <div class="col">
                        {% block h1 %}<h1 class="icon icon-link">
                            External Links Search<span></span></h1>
                        {% endblock %}
                    </div>
                </div>
            </div>
        </header>
    {% endblock %}
   
    {% block content_main %}
    <div class="nice-padding">
        <p>Enter an external link in the input field to see a list of pages that contain the URL.</p>

        <form method="post" class="fields external-links-search-form">
            {% csrf_token %}
               
                <div class="field iconfield">
                    <div class="input icon-search">
                        {{ form.url }}
                    </div>
                </div>
           
                <button type="submit" class="button">Search</button>
        </form>
        
        <div id="search-results">
            
            {% if num_page_results %}
                <h2 style="margin-top:45px">
                    {% if num_page_results > 1 %}
                        There are {{ num_page_results }} matching pages
                    {% else %}
                        There is 1 matching page
                    {% endif %}
                </h2>
                {% include "./_list_explore_revised.html" with show_parent=1 allow_navigation=0 %}
            {% endif %}

            {% if num_snippet_results %}
                <h2 style="margin-top:45px">
                    {% if num_snippet_results > 1 %}
                        There are {{ num_snippet_results }} matching snippets
                    {% else %}
                        There is 1 matching snippet
                    {% endif %}
                </h2>
                <table class="listing">
                    <thead>
                        <tr class="table-headers">
                            <th>Title</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for snippet in contacts %}
                        <tr>
                            <td class="title" valign="top">
                                <h2>
                                    <a href="{% url 'wagtailsnippets:edit' 'v1' 'contact' snippet.pk %}" target="_blank">
                                        {{ snippet }}
                                    </a>
                                </h2>
                            </td>
                            <td>
                                <a href="{% url 'wagtailsnippets:list' 'v1' 'contact' %}" target="_blank">
                                    Contacts
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                        {% for snippet in resources %}
                        <tr>
                            <td valign="top"class="title" valign="top">
                                <h2>
                                    <a href="{% url 'wagtailsnippets:edit' 'v1' 'resource' snippet.pk %}" target="_blank">
                                        {{ snippet }}
                                    </a>
                                </h2>
                            </td>
                            <td>
                                <a href="{% url 'wagtailsnippets:list' 'v1' 'resource' %}" target="_blank">
                                    Resources
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                        {% for snippet in reusable_texts %}
                        <tr>
                            <td class="title" valign="top">
                                <h2>
                                    <a href="{% url 'wagtailsnippets:edit' 'v1' 'reusabletext' snippet.pk %}" target="_blank">
                                        {{ snippet }}
                                    </a>
                                </h2>
                            </td>
                            <td valign="top">
                                <a href="{% url 'wagtailsnippets:list' 'v1' 'reusabletext' %}" target="_blank">
                                    Reusable Texts
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
    </div>
    {% endblock %}
{% endblock %}
